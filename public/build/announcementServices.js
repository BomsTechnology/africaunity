var r=(s,i,t)=>new Promise((e,m)=>{var v=l=>{try{f(t.next(l))}catch(A){m(A)}},g=l=>{try{f(t.throw(l))}catch(A){m(A)}},f=l=>l.done?e(l.value):Promise.resolve(l.value).then(v,g);f((t=t.apply(s,i)).next())});import{r as p,p as u,q as y}from"./app.js";function T(){const s=p([]),i=p([]),t=p(""),e=p(0),m=p(!1),v=p(1),g=a=>Object.entries(a).reduce((n,[o,c])=>(Array.isArray(c)?c.forEach(d=>n.append(`${o}[]`,d.file)):n.append(o,c),n),new FormData);return{filterAnnouncements:a=>r(this,null,function*(){t.value="";try{e.value=3;let n=yield u.post("/api/announcements-filter",a,{headers:{Authorization:`Bearer ${localStorage.token}`}});s.value=n.data.data,e.value=!1}catch(n){n.response.status==401&&(y.push({name:"login",params:{redirect:"not-login"}}),window.localStorage.removeItem("token"),window.localStorage.removeItem("user"))}}),isAll:m,page:v,announcements:s,announcement:i,errors:t,loading:e,getAnnouncements:()=>r(this,null,function*(){t.value="",e.value=!0;let a=yield u.get("/api/announcements?page="+v.value,{headers:{Authorization:`Bearer ${localStorage.token}`}});v.value==1?s.value=a.data.data:s.value=s.value.concat(a.data.data),e.value=!1,a.data.data.length==0&&(m.value=!0)}),getAnnouncement:a=>r(this,null,function*(){t.value="",e.value=!0;let n=yield u.get("/api/announcements/"+a,{headers:{Authorization:`Bearer ${localStorage.token}`}});e.value=0,i.value=n.data.data}),createAnnouncement:a=>r(this,null,function*(){t.value="";try{e.value=!0;let n=yield u.post("/api/announcements",g(a),{headers:{Authorization:`Bearer ${localStorage.token}`,"Content-Type":"multipart/form-data"}});e.value=!1}catch(n){if(n.response.status==422){e.value=0;for(const o in n.response.data.errors)t.value+=n.response.data.errors[o][0]+`
`}}}),updateAnnouncement:(a,n)=>r(this,null,function*(){t.value="";try{e.value=!0;let o=a.image.filter(h=>typeof h=="string"),c=a.image.filter(h=>typeof h!="string");a.image=c;let d=g(a);d.append("old_files",o),d.append("_method","PUT");let U=yield u.post("/api/announcements/"+i.value.id,d,{headers:{Authorization:`Bearer ${localStorage.token}`,"Content-Type":"multipart/form-data"}});e.value=!1}catch(o){if(e.value=0,o.response.status==422)for(const c in o.response.data.errors)t.value+=o.response.data.errors[c][0]+`	
`}}),destroyAnnouncement:a=>r(this,null,function*(){t.value="";try{e.value=!0,yield u.delete(`/api/announcements/${JSON.stringify(a)}`,{headers:{Authorization:`Bearer ${localStorage.token}`}}),e.value=!1}catch(n){e.value=0,n.response.status=="500"&&(t.value="Impossible de supprimer ce announcement")}}),getAnnouncementsUser:a=>r(this,null,function*(){t.value="",e.value=!0;let n=yield u.get("/api/announcements-user/"+a,{headers:{Authorization:`Bearer ${localStorage.token}`}});s.value=n.data.data,e.value=!1}),getAnnouncementsUniversity:a=>r(this,null,function*(){t.value="",e.value=!0;let n=yield u.get("/api/announcements-university/"+a,{headers:{Authorization:`Bearer ${localStorage.token}`}});s.value=n.data.data,e.value=!1}),getAnnouncement2:a=>r(this,null,function*(){t.value="",e.value=!0;let n=yield u.get("/api/announcements2/"+a,{headers:{Authorization:`Bearer ${localStorage.token}`}});e.value=0,i.value=n.data.data})}}export{T as u};

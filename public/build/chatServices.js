var o=(v,g,i)=>new Promise((t,a)=>{var f=l=>{try{p(i.next(l))}catch(d){a(d)}},m=l=>{try{p(i.throw(l))}catch(d){a(d)}},p=l=>l.done?t(l.value):Promise.resolve(l.value).then(f,m);p((i=i.apply(v,g)).next())});import{r as h,p as n,q as k}from"./app.js";function x(){const v=h([]),g=h([]),i=h([]),t=h(""),a=h(0),f=s=>o(this,null,function*(){t.value="";try{a.value=!0;let e=yield n.get("/api/chat/conversations/user/"+s,{headers:{Authorization:`Bearer ${localStorage.token}`}});v.value=yield y(e.data.data),a.value=!1}catch(e){e.response.status==401&&(k.push({name:"login",params:{redirect:"not-login"}}),window.localStorage.removeItem("token"),window.localStorage.removeItem("user"))}}),m=s=>o(this,null,function*(){t.value="";try{a.value=!0;let r=(yield n.get("/api/chat/folders/user/"+s,{headers:{Authorization:`Bearer ${localStorage.token}`}})).data.data;for(let c=0;c<r.length;c++)r[c].conversations=yield y(r[c].conversations);g.value=r,a.value=!1}catch(e){e.response.status==401&&(k.push({name:"login",params:{redirect:"not-login"}}),window.localStorage.removeItem("token"),window.localStorage.removeItem("user"))}}),p=s=>o(this,null,function*(){t.value="";try{a.value=!0;let e=yield n.post("/api/chat/conversations",s,{headers:{Authorization:`Bearer ${localStorage.token}`}});i.value=e.data.data,a.value=!1}catch(e){if(e.response.status==422){a.value=0;for(const r in e.response.data.errors)t.value+=e.response.data.errors[r][0]+`
`}}}),l=s=>o(this,null,function*(){t.value="";try{a.value=!0;let e=yield n.post("/api/chat/folders",s,{headers:{Authorization:`Bearer ${localStorage.token}`}});a.value=!1}catch(e){if(e.response.status==422){a.value=0;for(const r in e.response.data.errors)t.value+=e.response.data.errors[r][0]+`
`}}}),d=s=>o(this,null,function*(){t.value="";try{a.value=!0,yield n.post("/api/chat/folders/conversations",s,{headers:{Authorization:`Bearer ${localStorage.token}`}}),a.value=!1}catch(e){a.value=0,e.response.status=="500"&&(t.value="Impossible de supprimer ce chat")}}),S=s=>o(this,null,function*(){t.value="";try{a.value=!0;let e=yield n.post("/api/chat/messages",s,{headers:{Authorization:`Bearer ${localStorage.token}`}});i.value=e.data.data,a.value=!1}catch(e){if(e.response.status==422){a.value=0;for(const r in e.response.data.errors)t.value+=e.response.data.errors[r][0]+`
`}}}),z=s=>o(this,null,function*(){t.value="";try{let e=yield n.post("/api/chat/report/messages",s,{headers:{Authorization:`Bearer ${localStorage.token}`}})}catch(e){if(e.response&&e.response.status==422){a.value=0;for(const r in e.response.data.errors)t.value+=e.response.data.errors[r][0]+`
`}}}),A=s=>o(this,null,function*(){t.value="";try{let e=yield n.post("/api/chat/isread",s,{headers:{Authorization:`Bearer ${localStorage.token}`}});v.value=yield y(e.data.data)}catch(e){if(e.response.status==422){a.value=0;for(const r in e.response.data.errors)t.value+=e.response.data.errors[r][0]+`
`}}}),B=(s,e)=>o(this,null,function*(){t.value="";try{a.value=!0,yield n.post("/api/chat/messages/"+s,e,{headers:{Authorization:`Bearer ${localStorage.token}`,"Content-Type":"multipart/form-data"}}),a.value=!1}catch(r){if(a.value=0,r.response.status==422)for(const c in r.response.data.errors)t.value+=r.response.data.errors[c][0]+`	
`}}),$=(s,e)=>o(this,null,function*(){t.value="";try{a.value=!0,yield n.post("/api/chat/conversations/"+s+"/delete",e,{headers:{Authorization:`Bearer ${localStorage.token}`}}),a.value=!1}catch(r){a.value=0,r.response.status=="500"&&(t.value="Impossible de supprimer cette conversation")}}),C=s=>o(this,null,function*(){t.value="";try{a.value=!0,yield n.delete("/api/chat/folders/"+s,{headers:{Authorization:`Bearer ${localStorage.token}`}}),a.value=!1}catch(e){a.value=0,e.response.status=="500"&&(t.value="Impossible de supprimer ce Dossier")}}),I=(s,e)=>o(this,null,function*(){t.value="";try{a.value=!0,yield n.post("/api/chat/messages/"+s+"/delete",e,{headers:{Authorization:`Bearer ${localStorage.token}`}}),a.value=!1}catch(r){a.value=0,r.response.status=="500"&&(t.value="Impossible de supprimer ce Message")}}),M=(s,e)=>o(this,null,function*(){t.value="";try{a.value=!0,yield n.post("/api/chat/folders/conversations/"+s,{conversation_id:e},{headers:{Authorization:`Bearer ${localStorage.token}`}}),a.value=!1}catch(r){a.value=0,r.response.status=="500"&&(t.value="Impossible de retirer cette conversation")}}),y=s=>o(this,null,function*(){let e=s.filter(u=>u.messages.length>0),r=s.filter(u=>u.messages.length==0);return e.sort((u,w)=>{let F=new Date(w.messages[w.messages.length-1].date).getTime(),T=new Date(u.messages[u.messages.length-1].date).getTime();return F-T}),e.concat(r)});return{conversations:v,conversation:i,errors:t,loading:a,deleteMessage:I,updateMessage:B,removeCoversationToFolder:M,destroyCoversationFolder:C,addConversationToFolder:d,folders:g,isRead:A,createMessage:S,destroyConversation:$,getConversationsUser:f,createConversation:p,getConversationsFolderUser:m,createConversationFolder:l,reportMessage:z}}export{x as u};

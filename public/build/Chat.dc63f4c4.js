var Fe=Math.pow;var y=(x,j,z)=>new Promise((L,N)=>{var O=w=>{try{$(z.next(w))}catch(v){N(v)}},A=w=>{try{$(z.throw(w))}catch(v){N(v)}},$=w=>w.done?L(w.value):Promise.resolve(w.value).then(O,A);$((z=z.apply(x,j)).next())});import{d as s,e as l,f as e,r as M,I as F,L as E,m as Ue,K as P,h as i,g as p,M as he,t as g,F as f,x as C,N as ot,a as Se,o as nt,O as re,c as Ve,l as T,w as rt,j as it,P as dt,k as c,n as _,Q as Be}from"./app.59e8d623.js";import{_ as ut,r as ct,a as Le,b as Ee,c as Ae}from"./StartConversation.c766b3e4.js";import{u as ge}from"./chatServices.a7126c3e.js";import{r as ie}from"./UserCircleIcon.87b9d93c.js";import{r as de}from"./PhotoIcon.18108ee3.js";import{r as ue}from"./UserGroupIcon.f893ede1.js";import{r as X}from"./TrashIcon.564fd26b.js";import{r as ht}from"./PencilSquareIcon.f352cbc2.js";import{r as De}from"./FaceSmileIcon.666a1bd8.js";import{r as gt}from"./XMarkIcon.bf7b8432.js";import"./userServices.7388dd6e.js";function pt(x,j){return s(),l("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true"},[e("path",{"fill-rule":"evenodd",d:"M10.5 6a1.5 1.5 0 113 0 1.5 1.5 0 01-3 0zm0 6a1.5 1.5 0 113 0 1.5 1.5 0 01-3 0zm0 6a1.5 1.5 0 113 0 1.5 1.5 0 01-3 0z","clip-rule":"evenodd"})])}function ft(x,j){return s(),l("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true"},[e("path",{"fill-rule":"evenodd",d:"M9.401 3.003c1.155-2 4.043-2 5.197 0l7.355 12.748c1.154 2-.29 4.5-2.599 4.5H4.645c-2.309 0-3.752-2.5-2.598-4.5L9.4 3.003zM12 8.25a.75.75 0 01.75.75v3.75a.75.75 0 01-1.5 0V9a.75.75 0 01.75-.75zm0 8.25a.75.75 0 100-1.5.75.75 0 000 1.5z","clip-rule":"evenodd"})])}function ee(x,j){return s(),l("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true"},[e("path",{"fill-rule":"evenodd",d:"M19.5 21a3 3 0 003-3V9a3 3 0 00-3-3h-5.379a.75.75 0 01-.53-.22L11.47 3.66A2.25 2.25 0 009.879 3H4.5a3 3 0 00-3 3v12a3 3 0 003 3h15zM9 12.75a.75.75 0 000 1.5h6a.75.75 0 000-1.5H9z","clip-rule":"evenodd"})])}function mt(x,j){return s(),l("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true"},[e("path",{"fill-rule":"evenodd",d:"M19.5 21a3 3 0 003-3V9a3 3 0 00-3-3h-5.379a.75.75 0 01-.53-.22L11.47 3.66A2.25 2.25 0 009.879 3H4.5a3 3 0 00-3 3v12a3 3 0 003 3h15zm-6.75-10.5a.75.75 0 00-1.5 0v2.25H9a.75.75 0 000 1.5h2.25v2.25a.75.75 0 001.5 0v-2.25H15a.75.75 0 000-1.5h-2.25V10.5z","clip-rule":"evenodd"})])}function ce(x,j){return s(),l("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true"},[e("path",{"fill-rule":"evenodd",d:"M18.97 3.659a2.25 2.25 0 00-3.182 0l-10.94 10.94a3.75 3.75 0 105.304 5.303l7.693-7.693a.75.75 0 011.06 1.06l-7.693 7.693a5.25 5.25 0 11-7.424-7.424l10.939-10.94a3.75 3.75 0 115.303 5.304L9.097 18.835l-.008.008-.007.007-.002.002-.003.002A2.25 2.25 0 015.91 15.66l7.81-7.81a.75.75 0 011.061 1.06l-7.81 7.81a.75.75 0 001.054 1.068L18.97 6.84a2.25 2.25 0 000-3.182z","clip-rule":"evenodd"})])}function te(x,j){return s(),l("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true"},[e("path",{"fill-rule":"evenodd",d:"M12 3.75a.75.75 0 01.75.75v6.75h6.75a.75.75 0 010 1.5h-6.75v6.75a.75.75 0 01-1.5 0v-6.75H4.5a.75.75 0 010-1.5h6.75V4.5a.75.75 0 01.75-.75z","clip-rule":"evenodd"})])}const vt={class:"fixed inset-0 z-40 overflow-y-auto","aria-labelledby":"modal-title",role:"dialog","aria-modal":"true"},bt={class:"flex min-h-screen items-end justify-center px-4 pt-4 pb-20 text-center sm:block sm:p-0"},_t=e("span",{class:"hidden sm:inline-block sm:h-screen sm:align-middle","aria-hidden":"true"},"\u200B",-1),yt={class:"inline-block transform overflow-hidden rounded-lg p-4 bg-white text-left align-middle shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-lg"},xt=e("h1",{class:"text-2xl font-bold text-black"}," Ajouter un dossier ",-1),wt=["onSubmit"],kt={class:"relative"},Ct={class:"mt-5"},Mt=["disabled"],$t={key:0},jt={key:1},zt={__name:"CreateConversationFolder",props:{open:Boolean,toogleModal:Function},emits:["folderCreated"],setup(x,{emit:j}){const{createConversationFolder:z,loading:L,getConversationsFolderUser:N,errors:O}=ge(),A=JSON.parse(localStorage.user),$=M(""),w=()=>y(this,null,function*(){yield z({name:$.value,user_id:A.id}),j("folderCreated")});return(v,D)=>F((s(),l("div",vt,[e("div",bt,[e("div",{class:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity",style:{"backdrop-filter":"blur(5px)"},"aria-hidden":"true",onClick:D[0]||(D[0]=(...S)=>x.toogleModal&&x.toogleModal(...S))}),_t,e("div",yt,[xt,e("form",{onSubmit:Ue(w,["prevent"]),class:"relative mt-5"},[e("div",kt,[F(e("input",{type:"text","onUpdate:modelValue":D[1]||(D[1]=S=>$.value=S),class:"block w-full rounded-sm border border-gray-300 bg-gray-50 p-2.5 text-md text-gray-900 focus:border-blue-500 focus:ring-blue-500",placeholder:"Nom du dossier",required:""},null,512),[[P,$.value]])]),e("div",Ct,[e("button",{type:"submit",disabled:i(L),class:"text-md w-full rounded bg-primary-blue px-6 py-3 leading-5 text-white focus:outline-none"},[i(L)==1?(s(),l("span",$t,[p(he,{size:"small"})])):(s(),l("span",jt,g(v.$t("save")),1))],8,Mt)])],40,wt)])])],512)),[[E,x.open]])}},Ht={class:"fixed inset-0 z-40 overflow-y-auto","aria-labelledby":"modal-title",role:"dialog","aria-modal":"true"},Ft={class:"flex min-h-screen items-end justify-center px-4 pt-4 pb-20 text-center sm:block sm:p-0"},St=e("span",{class:"hidden sm:inline-block sm:h-screen sm:align-middle","aria-hidden":"true"},"\u200B",-1),Vt={class:"inline-block transform overflow-hidden rounded-lg bg-white text-left align-middle shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-lg"},Bt={class:"relative rounded-lg bg-white py-4"},Lt=e("h1",{class:"text-2xl font-bold text-black mx-4"}," Selectionner un dossier ",-1),Et={class:"max-h-96 min-h-[200px] overflow-y-auto mt-5"},At=["onClick"],Dt={key:1},Ut={__name:"AddConversationToFolder",props:{open:Boolean,toogleModal:Function,folders:Array,conversation:Object},emits:["conversationAdded"],setup(x,{emit:j}){const z=x,{loading:L,errors:N,addConversationToFolder:O}=ge(),A=$=>y(this,null,function*(){const w=$.conversations.filter(v=>v.id==z.conversation.id)[0];w||(yield O({conversation_id:z.conversation.id,conversation_folder_id:$.id})),j("conversationAdded",{isExist:!!w,folder:$})});return($,w)=>F((s(),l("div",Ht,[e("div",Ft,[e("div",{class:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity","aria-hidden":"true",style:{"backdrop-filter":"blur(5px)"},onClick:w[0]||(w[0]=(...v)=>x.toogleModal&&x.toogleModal(...v))}),St,e("div",Vt,[e("div",Bt,[Lt,e("div",Et,[x.folders.length!=[]?(s(!0),l(f,{key:0},C(x.folders,v=>(s(),l("button",{type:"button",key:v.id,onClick:D=>A(v),class:"cursor-pointer block w-full text-xl text-left bg-white px-6 py-2 hover:bg-gray-100"},g(v.name),9,At))),128)):(s(),l("div",Dt,[p(ot)]))])])])])],512)),[[E,x.open]])}};const Rt={class:"mx-auto w-full bg-white p-4 lg:px-20 xl:w-[90%]"},Tt={class:"relative h-full w-full overflow-x-auto sm:rounded-lg"},Nt={class:"relative flex h-[500px] w-full rounded-lg bg-white shadow-lg md:h-[700px]"},Ot={key:0,class:"w-full py-4"},It=e("span",null,[e("svg",{viewBox:"0 0 24 24",height:"25",fill:"currentColor",width:"25",preserveAspectRatio:"xMidYMid meet"},[e("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M5.16667 3.75C3.69391 3.75 2.5 4.94391 2.5 6.41667V17.5833C2.5 19.0561 3.69391 20.25 5.16667 20.25H18.8333C20.3061 20.25 21.5 19.0561 21.5 17.5833V8.75L23.7458 5.29499C24.1782 4.62974 23.7008 3.75 22.9073 3.75H5.16667ZM14.9672 12.9911H12.9914V14.9671C12.9914 15.3999 12.7366 15.8175 12.3238 15.9488C11.6391 16.1661 11.009 15.6613 11.009 15.009V12.9911H9.03279C8.59949 12.9911 8.1819 12.7358 8.05099 12.3226C7.83412 11.6381 8.33942 11.0089 8.99134 11.0089H11.009V9.03332C11.009 8.60007 11.2639 8.18252 11.6767 8.05119C12.3609 7.83391 12.9914 8.33872 12.9914 8.991V11.0089H15.0091C15.6606 11.0089 16.1659 11.6381 15.949 12.3226C15.8185 12.7358 15.4005 12.9911 14.9672 12.9911Z",fill:"currentColor"})])],-1),Kt=[It],Yt={class:"relative mx-2"},Pt={class:"pointer-events-none absolute inset-y-0 left-0 flex items-center pl-3"},qt={class:"mt-2 w-full px-2 py-2"},Zt={class:"no-scrollbar overflow-x-auto overflow-y-hidden"},Jt={class:"content items-scretch flex justify-start border-b"},Wt=e("span",null,"Tous",-1),Gt=[Wt],Qt=["onClick"],Xt={class:"flex flex-shrink-0 items-center justify-center"},es={class:"grow overflow-y-auto"},ts=["onClick"],ss={key:0,class:"group relative flex h-24 w-full cursor-pointer items-center space-x-2 border-b p-3"},ls={class:"h-12 w-12 overflow-hidden rounded-full lg:h-16 lg:w-16"},as=["src"],os={class:"flex-grow"},ns={class:"flex w-full justify-between"},rs={class:"whitespace-normal break-words text-base font-bold"},is={key:0},ds={key:0,class:"text-xs"},us={class:"flex w-full items-center justify-between"},cs={class:"flex items-center gap-1 whitespace-normal text-sm font-light"},hs={class:"flex w-full items-center justify-start gap-0.5 overflow-hidden overflow-ellipsis"},gs={key:0},ps={key:1},fs={key:0},ms={key:0,class:"flex h-6 w-6 items-center justify-center rounded-full bg-primary-blue text-sm font-light text-white"},vs=["onClick"],bs={key:1,class:"group flex h-24 w-full cursor-pointer items-center space-x-2 border-b p-3 hover:bg-gray-50"},_s={class:"h-12 w-12 overflow-hidden rounded lg:h-16 lg:w-16"},ys=["src"],xs={class:"flex-grow"},ws={class:"flex w-full justify-between"},ks={class:"whitespace-normal break-words text-base font-bold"},Cs={key:0},Ms={key:1},$s={key:0,class:"text-xs"},js={class:"flex w-full items-center justify-between"},zs={class:"whitespace-normal text-sm font-light text-gray-800"},Hs={class:"w-full overflow-hidden overflow-ellipsis"},Fs={key:0},Ss={key:0,class:"flex h-6 w-6 items-center justify-center rounded-full bg-primary-blue text-sm font-light text-white"},Vs=["onClick"],Bs=e("p",{class:"text-sm"},"Supprimer ce dossier",-1),Ls={class:"relative hidden w-full max-w-[30%] flex-col border-x py-4 lg:flex"},Es=e("span",null,[e("svg",{viewBox:"0 0 24 24",height:"25",fill:"currentColor",width:"25",preserveAspectRatio:"xMidYMid meet"},[e("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M5.16667 3.75C3.69391 3.75 2.5 4.94391 2.5 6.41667V17.5833C2.5 19.0561 3.69391 20.25 5.16667 20.25H18.8333C20.3061 20.25 21.5 19.0561 21.5 17.5833V8.75L23.7458 5.29499C24.1782 4.62974 23.7008 3.75 22.9073 3.75H5.16667ZM14.9672 12.9911H12.9914V14.9671C12.9914 15.3999 12.7366 15.8175 12.3238 15.9488C11.6391 16.1661 11.009 15.6613 11.009 15.009V12.9911H9.03279C8.59949 12.9911 8.1819 12.7358 8.05099 12.3226C7.83412 11.6381 8.33942 11.0089 8.99134 11.0089H11.009V9.03332C11.009 8.60007 11.2639 8.18252 11.6767 8.05119C12.3609 7.83391 12.9914 8.33872 12.9914 8.991V11.0089H15.0091C15.6606 11.0089 16.1659 11.6381 15.949 12.3226C15.8185 12.7358 15.4005 12.9911 14.9672 12.9911Z",fill:"currentColor"})])],-1),As=[Es],Ds={class:"relative mx-2"},Us={class:"pointer-events-none absolute inset-y-0 left-0 flex items-center pl-3"},Rs={class:"mt-2 w-full px-2 py-2"},Ts={class:"content items-scretch flex justify-start border-b"},Ns=e("span",null,"Tous",-1),Os=[Ns],Is=["onClick"],Ks={class:"flex flex-shrink-0 items-center justify-center"},Ys={class:"grow overflow-y-auto"},Ps=["onClick"],qs={key:0,class:"group relative flex h-24 w-full cursor-pointer items-center space-x-2 border-b p-3"},Zs={class:"h-12 w-12 overflow-hidden rounded-full lg:h-16 lg:w-16"},Js=["src"],Ws={class:"flex-grow"},Gs={class:"flex w-full justify-between"},Qs={class:"whitespace-normal break-words text-base font-bold"},Xs={key:0},el={key:0,class:"text-xs"},tl={class:"flex w-full items-center justify-between"},sl={class:"flex items-center gap-1 whitespace-normal text-sm font-light"},ll={class:"flex w-full items-center justify-start gap-0.5 overflow-hidden overflow-ellipsis"},al={key:0},ol={key:1},nl={key:0},rl={key:0,class:"flex h-6 w-6 items-center justify-center rounded-full bg-primary-blue text-sm font-light text-white"},il=["onClick"],dl={key:1,class:"group flex h-24 w-full cursor-pointer items-center space-x-2 border-b p-3 hover:bg-gray-50"},ul={class:"h-12 w-12 overflow-hidden rounded-full lg:h-16 lg:w-16"},cl=["src"],hl={class:"flex-grow"},gl={class:"flex w-full justify-between"},pl={class:"whitespace-normal break-words text-base font-bold"},fl={key:0},ml={key:1},vl={key:0,class:"text-xs"},bl={class:"flex w-full items-center justify-between"},_l={class:"whitespace-normal text-sm font-light text-gray-800"},yl={class:"w-full overflow-hidden overflow-ellipsis"},xl={key:0},wl={key:0,class:"flex h-6 w-6 items-center justify-center rounded-full bg-primary-blue text-sm font-light text-white"},kl=["onClick"],Cl=e("p",{class:"text-sm"},"Supprimer ce dossier",-1),Ml={class:"bg-chat relative flex w-full grow flex-col border-r"},$l={key:0,class:"relative flex h-24 w-full items-center justify-between space-x-2 border-b bg-white p-3"},jl={class:"flex items-center gap-2"},zl={class:"h-12 w-12 overflow-hidden rounded-full drop-shadow-md"},Hl=["src"],Fl=["src"],Sl={class:"whitespace-normal text-sm font-bold"},Vl={key:0},Bl={key:0},Ll={key:1},El={class:"text-[11px]"},Al={key:0},Dl=e("p",{class:"text-sm"},"Ajouter \xE0 un dossier",-1),Ul=e("p",{class:"text-sm"},"Supprimer",-1),Rl={class:"flex min-h-0 w-full flex-col items-end justify-end"},Tl=e("p",{class:"text-xs"},"Editer",-1),Nl=e("p",{class:"text-xs"},"Signaler",-1),Ol=e("p",{class:"text-xs"},"Supprimer",-1),Il={class:"rounded bg-white px-2 py-1 text-center text-xs uppercase text-gray-700 shadow"},Kl=["onContextmenu"],Yl=["href","download"],Pl={style:{"backdrop-filter":"blur(5px)"},class:"absolute right-0 top-0 hidden items-center bg-white/50 p-2 text-primary-blue hover:bg-primary-blue/50 hover:text-black group-hover:flex"},ql={class:"block"},Zl=e("span",{class:"block"},"Telecharger",-1),Jl=["src"],Wl={class:"absolute bottom-0 w-full bg-white/50 p-2 text-xs"},Gl={class:"block break-words text-xs font-medium"},Ql={class:"mt-1 block break-words text-[11px]"},Xl=["href","download"],ea={style:{"backdrop-filter":"blur(5px)"},class:"absolute right-0 top-0 hidden items-center bg-white/50 p-2 text-primary-blue hover:bg-primary-blue/50 hover:text-black group-hover:flex"},ta={class:"block"},sa=e("span",{class:"block"},"Telecharger",-1),la={class:"flex h-20 w-32 items-center justify-center bg-gray-500 font-bold uppercase text-white"},aa={class:"flex grow flex-col items-start justify-start p-2"},oa={class:"break-words text-xs"},na={class:"break-words text-[11px]"},ra={class:"text-md"},ia={class:"mt-2 flex items-center gap-1 text-right text-xs font-light"},da={class:"block"},ua={key:0,class:"block italic"},ca={key:0,class:"relative mt-2"},ha=["onUpdate:modelValue","rows"],ga={key:0},pa={key:1},fa={class:"mx-auto w-full md:max-w-[70%]"},ma={class:"relative flex items-end gap-2 rounded-lg px-3 py-2"},va=["disabled"],ba=["disabled"],_a={class:"relative flex w-full flex-col"},ya={class:"h-20 w-32"},xa=["src"],wa={key:1,class:"flex h-full w-full items-center justify-center bg-gray-500 text-white"},ka={class:"flex grow flex-col items-start justify-start p-2"},Ca={class:"break-words text-xs"},Ma={class:"break-words text-[11px]"},$a=e("emoji-picker",{locale:"fr"},null,-1),ja=[$a],za=["rows","onKeydown","disabled"],Ha=["disabled"],Fa={key:0},Sa={key:1},Va={class:"fixed left-0 top-0 z-20 flex h-screen w-screen items-center justify-center",style:{"backdrop-filter":"blur(5px)"}},Ba={class:"min-w-[300px] rounded bg-white p-4 shadow"},La=e("p",{class:""},"Supprimer le message ?",-1),Ea={class:"mt-5 flex flex-col items-end justify-end gap-3"},Za={__name:"Chat",setup(x){const{createConversation:j,loading:z,errors:L,conversation:N,createMessage:O,destroyConversation:A,updateMessage:$,getConversationsUser:w,conversations:v,isRead:D,folders:S,getConversationsFolderUser:U,removeCoversationToFolder:Re,destroyCoversationFolder:Te,deleteMessage:Ne,reportMessage:Oe}=ge(),q=M(null),pe=M(null),fe=M(null),m=M(null),H=M(null),se=M(null),me=M(null),Z=M(null),ve=M(1),be=M(1),R=M(""),le=M(!1),J=M(!1),W=M(!1),d=M(null),k=M(null),h=M(null);h.value=JSON.parse(localStorage.user);const r=Se({chat:!0,conversation:!1,emoji:!1,option:!1,optionMessage:!1,editMessage:!1,deleteMessage:!1}),u=Se({message:"",user_id:h.value.id,conversation_id:"",attachement:null,attachement_path:"",attachement_name:"",attachement_size:"",type:"text"});nt(()=>y(this,null,function*(){yield w(h.value.id),H.value=v.value,yield U(h.value.id),document.onkeydown=function(a){a=a||window.event,a.keyCode==27&&(r.emoji?r.emoji=!1:r.editMessage?(r.editMessage=!1,r.optionMessage=!1):r.optionMessage?r.optionMessage=!1:r.option?r.option=!1:d.value?(d.value=null,Y()):m.value=null)},se.value.querySelector("emoji-picker").addEventListener("emoji-click",a=>{r.editMessage?k.value.message+=`${a.detail.unicode} `:u.message+=`${a.detail.unicode} `}),window.Echo.channel(`chat.${h.value.id}`).listen(".chat-update",a=>y(this,null,function*(){ne(),at()}))})),re(se,()=>{r.emoji=!1}),re(me,()=>{r.option=!1}),re(Z,()=>{r.optionMessage=!1});const Y=(a=!1)=>{a||(u.message="",u.conversation_id=""),u.attachement="",u.attachement_path="",u.attachement_name="",u.attachement_size="",u.type="text",r.editMessage=!1,k.value=null};function _e(a){switch(a){case"chat":r.conversation=!1,r.chat=!0;break;case"conversation":r.chat=!1,r.conversation=!0;break}}const I=()=>{le.value=!le.value},ae=()=>{W.value=!W.value},ye=()=>{J.value=!J.value},Ie=()=>y(this,null,function*(){yield U(h.value.id),W.value=!1}),Ke=a=>y(this,null,function*(){r.option=!1,H.value=a.folder.conversations,m.value=a.folder,J.value=!1,a.isExist||(yield U(h.value.id).then(o=>{let t=S.value.filter(b=>b.id==a.folder.id)[0];H.value=t.conversations,m.value=t}))}),Ye=a=>y(this,null,function*(){I();let o=v.value.filter(t=>t.users.find(b=>b.id==a.id))[0];o?d.value=o:(yield j({users:[h.value.id,a.id]}),ne(),d.value=N.value),Y()}),Pe=()=>{r.editMessage=!0,setTimeout(()=>{je(fe.value[0].value)},100)},xe=()=>y(this,null,function*(){const a=d.value.users.filter(o=>o.id!=h.value.id)[0];k.value.is_edit=!0,r.editMessage=!1,$(k.value.id,{text:k.value.message,received_id:a.id})}),we=a=>y(this,null,function*(){r.deleteMessage=!1;const o=d.value.messages.indexOf(k.value);if(o>=0){const t=d.value.users.filter(b=>b.id!=h.value.id)[0];d.value.messages.splice(o,1),yield Ne(k.value.id,{for:a,user_id:h.value.id,received_id:t.id})}}),qe=()=>y(this,null,function*(){r.optionMessage=!1,yield Oe({conversation_id:d.value.id,message_id:k.value.id}),alert("Report sucess")}),Ze=()=>y(this,null,function*(){r.optionMessage=!1,r.deleteMessage=!0}),Je=()=>y(this,null,function*(){ye(),r.option=!1}),G=a=>y(this,null,function*(){if(confirm("Are you sure you want to remove this conversation in folder?")){const o=m.value.conversations.indexOf(a);o>=0&&(m.value.conversations.splice(o,1),yield Re(m.value.id,a.id),yield U(h.value.id))}}),ke=()=>y(this,null,function*(){confirm("Are you sure you want to delete this folder?")&&(yield Te(m.value.id),H.value=v.value,m.value=null,yield U(h.value.id))}),We=()=>y(this,null,function*(){confirm("Are you sure you want to delete this conversation?")&&(r.option=!1,yield A(d.value.id,{user_id:h.value.id}),d.value=null,yield w(h.value.id),yield U(h.value.id),m.value==null?H.value=v.value:(m.value=S.value.filter(a=>a.id===m.value.id)[0],H.value=m.value.conversations))}),Q=Ve(()=>H.value?H.value.filter(a=>a.users.some(o=>o.id!=h.value.id&&(o.firstname.toLowerCase().includes(R.value.toLowerCase())||o.email.toLowerCase().includes(R.value.toLowerCase()))||o.lastname&&o.lastname.toLowerCase().includes(R.value.toLowerCase()))):[]),Ce=Ve(()=>{let a={};return d.value.messages.forEach(o=>{a[`${B(o.date,!0)}`]||(a[`${B(o.date,!0)}`]=[]),a[`${B(o.date,!0)}`].push(o)}),a}),oe=a=>{H.value=a.conversations,m.value=a};function Me(a){d.value=a,u.conversation_id=a.id,Y();const o=d.value.users.filter(t=>t.id!=h.value.id)[0];D({conversation_id:d.value.id,user_id:h.value.id,received_id:o.id}),_e("chat")}function $e(){return y(this,null,function*(){if(d.value&&!z.value&&(u.message||u.attachement)){u.conversation_id=d.value.id;const a={id:new Date().getTime(),user_id:h.value.id,user:h.value,is_send:!1,is_read:!1,date:Date.now(),attachement_path:u.attachement_path,attachement_name:u.attachement_name,message:u.message,type:u.type,conversation_id:u.conversation_id};v.value.filter(b=>b.id===d.value.id)[0].messages.push(a),oe.value&&d.value.messages.push(a);const o=d.value.users.filter(b=>b.id!=h.value.id)[0];let t=new FormData;t.append("received_id",o.id),t.append("user_id",h.value.id),t.append("conversation_id",u.conversation_id),t.append("attachement",u.attachement),t.append("attachement_path",u.attachement_path),t.append("attachement_name",u.attachement_name),t.append("attachement_size",u.attachement_size),t.append("type",u.type),t.append("message",u.message),Y(),yield O(t),ne()}})}function B(a,o,t=!1){a=new Date(a);const b=new Date,n=Math.round((b-a)/(1e3*60*60*24)),K={weekday:"long",year:"numeric",month:"long",day:"numeric"},V=["Dimanche","Lundi","Mardi","Mercredi","Jeudi","Vendredi","Samedi"];return n===0?o?"Aujourd'hui":`${a.getHours()>9?a.getHours():"0"+a.getHours()}:${a.getMinutes()>9?a.getMinutes():"0"+a.getMinutes()}`:n===1?o||t?"Hier":`${a.getHours()>9?a.getHours():"0"+a.getHours()}:${a.getMinutes()>9?a.getMinutes():"0"+a.getMinutes()}`:n>1&&n<7?o||t?V[a.getDay()]:`${a.getHours()>9?a.getHours():"0"+a.getHours()}:${a.getMinutes()>9?a.getMinutes():"0"+a.getMinutes()}`:o&&!t?a.toLocaleDateString("fr-FR",K):!o&&t?a.toLocaleDateString("fr-FR"):`${a.getHours()>9?a.getHours():"0"+a.getHours()}:${a.getMinutes()>9?a.getMinutes():"0"+a.getMinutes()}`}const Ge=a=>{a.preventDefault();const o=a.currentTarget,t=a.deltaY;o.scrollLeft+=t},Qe=a=>{if(a.shiftKey&&a.key==="Enter"){a.preventDefault();const o=a.target,t=o.selectionStart,b=o.selectionEnd,n=o.value;o.value=n.substring(0,t)+`
`+n.substring(b),o.selectionStart=o.selectionEnd=t+1}else a.preventDefault(),$e()},Xe=()=>{const o=(pe.value.value.match(/\n/g)||[]).length+1;ve.value=o<10?o:10},et=a=>{if(a.shiftKey&&a.key==="Enter"){a.preventDefault();const o=a.target,t=o.selectionStart,b=o.selectionEnd,n=o.value;o.value=n.substring(0,t)+`
`+n.substring(b),o.selectionStart=o.selectionEnd=t+1}else a.preventDefault(),xe()},je=a=>{const o=(a.match(/\n/g)||[]).length+1;be.value=o<10?o:10},tt=(a,o)=>{a.preventDefault(),r.editMessage||(Z.value.style.left=`${a.clientX+10}px`,Z.value.style.top=`${a.clientY+10}px`,r.option=!1,r.emoji=!1,k.value=o,r.optionMessage=!0)},st=a=>y(this,null,function*(){const o=a.target.files[0];u.type="image",u.attachement=o,u.attachement_name=o.name,u.attachement_path=ze(o),u.attachement_size=He(o.size)}),lt=a=>y(this,null,function*(){const o=a.target.files[0];u.type="file",u.attachement=o,u.attachement_name=o.name,u.attachement_path=ze(o),u.attachement_size=He(o.size)}),at=()=>{q.value!=null&&q.value.scroll({top:q.value.scrollHeight,behavior:"smooth"})},ne=()=>y(this,null,function*(){yield w(h.value.id),d.value&&(d.value=v.value.filter(a=>a.id===d.value.id)[0]),yield U(h.value.id),m.value==null?H.value=v.value:(m.value=S.value.filter(a=>a.id===m.value.id)[0],H.value=m.value.conversations)});function ze(a){return URL.createObjectURL(a)}function He(a){const o=["Bytes","KB","MB","GB","TB"];if(a===0)return"n/a";const t=parseInt(Math.floor(Math.log(a)/Math.log(1024)),10);return t===0?`${a} ${o[t]})`:`${(a/Fe(1024,t)).toFixed(1)} ${o[t]}`}return(a,o)=>(s(),l("div",Rt,[p(ut,{open:le.value,toogleModal:I,conversationSelect:Ye},null,8,["open"]),p(Ut,{open:J.value,toogleModal:ye,folders:i(S),conversation:d.value,onConversationAdded:Ke},null,8,["open","folders","conversation"]),p(zt,{open:W.value,toogleModal:ae,onFolderCreated:Ie},null,8,["open"]),i(L)!=""?(s(),T(dt,{key:0},{default:rt(()=>[it(g(i(L)),1)]),_:1})):c("",!0),e("section",Tt,[e("div",Nt,[e("button",{onClick:o[0]||(o[0]=t=>_e("conversation")),type:"button",class:_([[r.conversation?" border-primary-blue bg-primary-blue ":"   border-primary-blue bg-white  text-primary-blue "],"absolute left-0 top-0 z-10 rounded-full border p-2 text-white shadow lg:hidden"])},[p(i(ct),{class:"h-5 w-5"})],2),r.conversation?(s(),l("div",Ot,[e("div",{class:"flex justify-end items-center mb-4 px-2"},[e("button",{type:"button",onClick:I,class:"text-primary-blue",title:"Nouvelle conversation"},Kt)]),e("div",Yt,[e("div",Pt,[p(i(Le),{class:"h-5 w-5 text-gray-500"})]),F(e("input",{type:"text","onUpdate:modelValue":o[1]||(o[1]=t=>R.value=t),class:"block w-full border border-gray-300 bg-gray-50 p-2.5 pl-10 text-sm text-gray-900 focus:border-primary-blue focus:ring-primary-blue",placeholder:"Rechercher une Personne ou un \xE9tablissement...",required:""},null,512),[[P,R.value]])]),e("button",{type:"button",onClick:I,class:"absolute bottom-10 right-5 hidden h-12 w-12 cursor-pointer items-center justify-center rounded-full bg-primary-blue p-2 text-white shadow-lg"},[p(i(te),{class:"h-10 w-10"})]),e("div",qt,[e("div",Zt,[e("div",Jt,[e("button",{type:"button",onClick:o[2]||(o[2]=()=>{H.value=i(v),m.value=null}),class:_(["flex-shrink-0 cursor-pointer rounded-t-md px-4 py-2 text-center font-bold",[m.value?"border-gray-500 text-gray-500 hover:bg-gray-50":"border-b-2 border-primary-blue text-primary-blue hover:bg-blue-100"]])},Gt,2),(s(!0),l(f,null,C(i(S),t=>(s(),l("button",{type:"button",key:t.id,onClick:b=>oe(t),class:_(["flex-shrink-0 cursor-pointer rounded-t-md px-4 py-2 text-center font-bold",[m.value&&m.value.id==t.id?"border-b-2 border-primary-blue text-primary-blue hover:bg-blue-100":"border-gray-500 text-gray-500 hover:bg-gray-50"]])},[e("span",null,g(t.name),1)],10,Qt))),128)),e("div",Xt,[e("button",{type:"button",onClick:ae,class:"flex h-5 w-5 cursor-pointer items-center justify-center rounded-full bg-primary-blue p-0.5 text-white shadow-lg"},[p(i(te),{class:"h-full w-full"})])])])])]),e("div",es,[Q.value.length!=[]?(s(!0),l(f,{key:0},C(Q.value,(t,b)=>(s(),l("div",{key:t.id,onClick:n=>Me(t),class:_([d.value&&d.value.id==t.id?"bg-primary-blue text-white":"text-gray-800 hover:bg-gray-100"])},[t.type=="conversation"?(s(),l("div",ss,[e("div",ls,[(s(!0),l(f,null,C(t.users,n=>(s(),l(f,null,[n.id!=h.value.id?(s(),l(f,{key:0},[n.avatar?(s(),l("img",{key:0,src:n.avatar,class:"h-full w-full bg-cover object-cover",alt:""},null,8,as)):(s(),T(i(ie),{key:1,class:"h-full w-full"}))],64)):c("",!0)],64))),256))]),e("div",os,[e("div",ns,[e("h1",rs,[(s(!0),l(f,null,C(t.users,n=>(s(),l(f,null,[n.id!=h.value.id?(s(),l("span",is,g(n.firstname),1)):c("",!0)],64))),256))]),t.messages.length>0?(s(),l("span",ds,g(B(t.messages[t.messages.length-1].date,!1,!0)),1)):c("",!0)]),e("div",us,[e("h6",cs,[t.messages.length>0?(s(),l(f,{key:0},[e("span",{class:_(["block h-2 w-2 flex-shrink-0 rounded-full",[t.messages[t.messages.length-1].is_send?t.messages[t.messages.length-1].is_read?"bg-green-500":"bg-gray-400  ":"bg-red-500"]])},null,2),e("span",hs,[t.messages[t.messages.length-1].type=="file"?(s(),l("span",gs,[p(i(ce),{class:"h-4 w-4"})])):t.messages[t.messages.length-1].type=="image"?(s(),l("span",ps,[p(i(de),{class:"h-4 w-4"})])):c("",!0),e("span",null,g(t.messages[t.messages.length-1].message.length>35?t.messages[t.messages.length-1].message.substring(0,35)+"...":t.messages[t.messages.length-1].message),1)])],64)):(s(!0),l(f,{key:1},C(t.users,n=>(s(),l(f,null,[n.id!=h.value.id?(s(),l("span",fs,g(n.email),1)):c("",!0)],64))),256))]),t.nbUnRead>0?(s(),l("span",ms,[e("span",null,g(t.nbUnRead),1)])):c("",!0)])]),m.value?(s(),l("button",{key:0,onClick:n=>G(t),type:"button",class:"hidden h-6 w-6 items-center justify-center rounded-full text-red-300 hover:bg-red-100 hover:text-red-500 group-hover:flex"},[e("span",null,[p(i(ee),{class:"h-4 w-4"})])],8,vs)):c("",!0)])):(s(),l("div",bs,[e("div",_s,[t.image?(s(),l("img",{key:0,src:t.image,class:"h-full w-full bg-cover object-cover",alt:""},null,8,ys)):(s(),T(i(ue),{key:1,class:"h-full w-full text-gray-500"}))]),e("div",xs,[e("div",ws,[e("h1",ks,[t.name?(s(),l("span",Cs,g(t.name),1)):(s(),l("span",Ms,"Sans nom"))]),t.messages.length>0?(s(),l("span",$s,g(B(t.messages[t.messages.length-1].date,!0,!0)),1)):c("",!0)]),e("div",js,[e("h6",zs,[t.messages.length>0?(s(),l(f,{key:0},[e("span",{class:_(["block h-2 w-2 flex-shrink-0 rounded-full",[t.messages[t.messages.length-1].is_send?t.messages[t.messages.length-1].is_read?"bg-green-500":"bg-gray-400  ":"bg-red-500"]])},null,2),e("span",Hs,g(t.messages[t.messages.length-1].message.length>35?t.messages[t.messages.length-1].message.substring(0,35)+"...":t.messages[t.messages.length-1].message),1)],64)):(s(!0),l(f,{key:1},C(t.users,(n,K)=>(s(),l("span",null,[K<3?(s(),l("span",Fs,g(n.email)+", ",1)):c("",!0)]))),256))]),t.nbUnRead>0?(s(),l("span",Ss,[e("span",null,g(t.nbUnRead),1)])):c("",!0)])]),m.value?(s(),l("button",{key:0,onClick:n=>G(t),type:"button",class:"flex h-6 w-6 items-center justify-center rounded-full bg-red-100 text-red-500"},[e("span",null,[p(i(ee),{class:"h-4 w-4"})])],8,Vs)):c("",!0)]))],10,ts))),128)):c("",!0),m.value?(s(),l("button",{key:1,type:"button",onClick:ke,class:"flex w-full items-center justify-center gap-1 p-2 text-red-500 opacity-25 hover:bg-red-100 hover:opacity-100"},[e("span",null,[p(i(X),{class:"h-4 w-4"})]),Bs])):c("",!0)])])):c("",!0),e("div",Ls,[e("div",{class:"flex justify-end items-center mb-4 px-2"},[e("button",{type:"button",onClick:I,class:"text-primary-blue",title:"Nouvelle conversation"},As)]),e("div",Ds,[e("div",Us,[p(i(Le),{class:"h-5 w-5 text-gray-500"})]),F(e("input",{type:"text","onUpdate:modelValue":o[3]||(o[3]=t=>R.value=t),class:"block w-full border border-gray-300 bg-gray-50 p-2.5 pl-10 text-sm text-gray-900 focus:border-primary-blue focus:ring-primary-blue",placeholder:"Rechercher une Personne ou un \xE9tablissement...",required:""},null,512),[[P,R.value]])]),e("button",{type:"button",onClick:I,class:"absolute hidden bottom-10 right-5 h-12 w-12 cursor-pointer items-center justify-center rounded-full bg-primary-blue p-2 text-white shadow-lg"},[p(i(te),{class:"h-10 w-10"})]),e("div",Rs,[e("div",{onWheel:Ge,class:"no-scrollbar overflow-x-auto overflow-y-hidden"},[e("div",Ts,[e("button",{type:"button",onClick:o[4]||(o[4]=()=>{H.value=i(v),m.value=null}),class:_(["flex-shrink-0 cursor-pointer rounded-t-md px-4 py-2 text-center font-bold",[m.value?"border-gray-500 text-gray-500 hover:bg-gray-50":"border-b-2 border-primary-blue text-primary-blue hover:bg-blue-100"]])},Os,2),(s(!0),l(f,null,C(i(S),t=>(s(),l("button",{type:"button",key:t.id,onClick:b=>oe(t),class:_(["flex-shrink-0 cursor-pointer rounded-t-md px-4 py-2 text-center font-bold",[m.value&&m.value.id==t.id?"border-b-2 border-primary-blue text-primary-blue hover:bg-blue-100":"border-gray-500 text-gray-500 hover:bg-gray-50"]])},[e("span",null,g(t.name),1)],10,Is))),128)),e("div",Ks,[e("button",{type:"button",onClick:ae,class:"flex h-5 w-5 cursor-pointer items-center justify-center rounded-full bg-primary-blue p-0.5 text-white shadow-lg"},[p(i(te),{class:"h-full w-full"})])])])],32)]),e("div",Ys,[Q.value.length!=[]?(s(!0),l(f,{key:0},C(Q.value,(t,b)=>(s(),l("div",{key:t.id,onClick:n=>Me(t),class:_([d.value&&d.value.id==t.id?"bg-primary-blue text-white":"text-gray-800 hover:bg-gray-100"])},[t.type=="conversation"?(s(),l("div",qs,[e("div",Zs,[(s(!0),l(f,null,C(t.users,n=>(s(),l(f,null,[n.id!=h.value.id?(s(),l(f,{key:0},[n.avatar?(s(),l("img",{key:0,src:n.avatar,class:"h-full w-full bg-cover object-cover",alt:""},null,8,Js)):(s(),T(i(ie),{key:1,class:"h-full w-full"}))],64)):c("",!0)],64))),256))]),e("div",Ws,[e("div",Gs,[e("h1",Qs,[(s(!0),l(f,null,C(t.users,n=>(s(),l(f,null,[n.id!=h.value.id?(s(),l("span",Xs,g(n.firstname),1)):c("",!0)],64))),256))]),t.messages.length>0?(s(),l("span",el,g(B(t.messages[t.messages.length-1].date,!1,!0)),1)):c("",!0)]),e("div",tl,[e("h6",sl,[t.messages.length>0?(s(),l(f,{key:0},[e("span",{class:_(["block h-2 w-2 flex-shrink-0 rounded-full",[t.messages[t.messages.length-1].is_send?t.messages[t.messages.length-1].is_read?"bg-green-500":"bg-gray-400  ":"bg-red-500"]])},null,2),e("span",ll,[t.messages[t.messages.length-1].type=="file"?(s(),l("span",al,[p(i(ce),{class:"h-4 w-4"})])):t.messages[t.messages.length-1].type=="image"?(s(),l("span",ol,[p(i(de),{class:"h-4 w-4"})])):c("",!0),e("span",null,g(t.messages[t.messages.length-1].message.length>35?t.messages[t.messages.length-1].message.substring(0,35)+"...":t.messages[t.messages.length-1].message),1)])],64)):(s(!0),l(f,{key:1},C(t.users,n=>(s(),l(f,null,[n.id!=h.value.id?(s(),l("span",nl,g(n.email),1)):c("",!0)],64))),256))]),t.nbUnRead>0?(s(),l("span",rl,[e("span",null,g(t.nbUnRead),1)])):c("",!0)])]),m.value?(s(),l("button",{key:0,onClick:n=>G(t),type:"button",class:"hidden h-6 w-6 items-center justify-center rounded-full text-red-300 hover:bg-red-100 hover:text-red-500 group-hover:flex"},[e("span",null,[p(i(ee),{class:"h-4 w-4"})])],8,il)):c("",!0)])):(s(),l("div",dl,[e("div",ul,[t.image?(s(),l("img",{key:0,src:t.image,class:"h-full w-full bg-cover object-cover",alt:""},null,8,cl)):(s(),T(i(ue),{key:1,class:"h-full w-full text-gray-500"}))]),e("div",hl,[e("div",gl,[e("h1",pl,[t.name?(s(),l("span",fl,g(t.name),1)):(s(),l("span",ml,"Sans nom"))]),t.messages.length>0?(s(),l("span",vl,g(B(t.messages[t.messages.length-1].date,!0,!0)),1)):c("",!0)]),e("div",bl,[e("h6",_l,[t.messages.length>0?(s(),l(f,{key:0},[e("span",{class:_(["block h-2 w-2 flex-shrink-0 rounded-full",[t.messages[t.messages.length-1].is_send?t.messages[t.messages.length-1].is_read?"bg-green-500":"bg-gray-400  ":"bg-red-500"]])},null,2),e("span",yl,g(t.messages[t.messages.length-1].message.length>35?t.messages[t.messages.length-1].message.substring(0,35)+"...":t.messages[t.messages.length-1].message),1)],64)):(s(!0),l(f,{key:1},C(t.users,(n,K)=>(s(),l("span",null,[K<3?(s(),l("span",xl,g(n.email)+", ",1)):c("",!0)]))),256))]),t.nbUnRead>0?(s(),l("span",wl,[e("span",null,g(t.nbUnRead),1)])):c("",!0)])]),m.value?(s(),l("button",{key:0,onClick:n=>G(t),type:"button",class:"hidden h-6 w-6 items-center justify-center rounded-full text-red-300 hover:bg-red-100 hover:text-red-500 group-hover:flex"},[e("span",null,[p(i(ee),{class:"h-4 w-4"})])],8,kl)):c("",!0)]))],10,Ps))),128)):c("",!0),m.value?(s(),l("button",{key:1,type:"button",onClick:ke,class:"flex w-full items-center justify-center gap-1 p-2 text-red-500 opacity-25 hover:bg-red-100 hover:opacity-100"},[e("span",null,[p(i(X),{class:"h-4 w-4"})]),Cl])):c("",!0)])]),F(e("div",Ml,[d.value?(s(),l("div",$l,[e("div",jl,[e("div",zl,[d.value.type=="conversation"?(s(!0),l(f,{key:0},C(d.value.users,t=>(s(),l(f,null,[t.id!=h.value.id?(s(),l(f,{key:0},[t.avatar?(s(),l("img",{key:0,src:t.avatar,class:"h-full w-full bg-cover object-cover",alt:""},null,8,Hl)):(s(),T(i(ie),{key:1,class:"h-full w-full text-gray-800"}))],64)):c("",!0)],64))),256)):(s(),l(f,{key:1},[d.value.image?(s(),l("img",{key:0,src:d.value.image,class:"h-full w-full bg-cover object-cover",alt:""},null,8,Fl)):(s(),T(i(ue),{key:1,class:"h-full w-full text-gray-800"}))],64))]),e("div",null,[e("h1",Sl,[d.value.type=="conversation"?(s(!0),l(f,{key:0},C(d.value.users,t=>(s(),l(f,null,[t.id!=h.value.id?(s(),l("span",Vl,g(t.firstname),1)):c("",!0)],64))),256)):(s(),l(f,{key:1},[d.value.name?(s(),l("span",Bl,g(d.value.name),1)):(s(),l("span",Ll,"Sans nom"))],64))]),e("p",El,[d.value.type=="conversation"?(s(!0),l(f,{key:0},C(d.value.users,t=>(s(),l(f,null,[t.id!=h.value.id?(s(),l("span",Al,g(t.email),1)):c("",!0)],64))),256)):(s(!0),l(f,{key:1},C(d.value.users,t=>(s(),l("span",null,g(t.firstname)+",",1))),256))])])]),e("button",{type:"button",onClick:o[5]||(o[5]=()=>{r.editMessage||(r.option=!r.option)}),class:"rounded p-0.5 hover:bg-gray-100"},[p(i(pt),{class:"h-8 w-8 text-gray-900"})]),F(e("div",{ref_key:"optionBlock",ref:me,class:"items-scretch absolute right-5 top-[80%] z-20 flex min-w-[80px] flex-col justify-start overflow-hidden rounded bg-white shadow"},[d.value.type!="group"?(s(),l("button",{key:0,onClick:Je,type:"button",class:"text-block flex items-center gap-1 p-2 hover:bg-gray-100"},[e("span",null,[p(i(mt),{class:"h-4 w-4"})]),Dl])):c("",!0),c("",!0),e("button",{type:"button",onClick:We,class:"flex items-center gap-1 p-2 text-red-500 hover:bg-gray-100"},[e("span",null,[p(i(X),{class:"h-4 w-4"})]),Ul])],512),[[E,r.option]])])):c("",!0),e("div",{ref_key:"chatDiv",ref:q,class:"no-scrollbar mx-auto flex w-full grow flex-col-reverse items-center justify-center overflow-scroll p-4 md:max-w-[70%]"},[e("div",Rl,[F(e("div",{ref_key:"optionMessageBlock",ref:Z,class:"items-scretch fixed z-50 flex min-w-[100px] flex-col justify-start overflow-hidden rounded bg-white shadow"},[k.value&&k.value.user.id==h.value.id?(s(),l("button",{key:0,type:"button",onClick:Pe,class:"flex items-center gap-1 p-2 text-black hover:bg-gray-100"},[e("span",null,[p(i(ht),{class:"h-4 w-4"})]),Tl])):c("",!0),e("button",{type:"button",onClick:qe,class:"flex items-center gap-1 p-2 text-black hover:bg-gray-100"},[e("span",null,[p(i(ft),{class:"h-4 w-4"})]),Nl]),e("button",{type:"button",onClick:Ze,class:"flex items-center gap-1 p-2 text-red-500 hover:bg-gray-100"},[e("span",null,[p(i(X),{class:"h-4 w-4"})]),Ol])],512),[[E,r.optionMessage&&!r.editMessage]]),d.value&&Ce.value.length!=[]?(s(!0),l(f,{key:0},C(Ce.value,(t,b)=>(s(),l("div",{key:b,class:"w-full"},[e("div",{class:_(["sticky top-0 my-4 flex items-center justify-center",[r.editMessage?"blur":""]])},[e("span",Il,g(B(t[0].date,!0)),1)],2),(s(!0),l(f,null,C(t,(n,K)=>(s(),l("div",{key:n.id,class:_(["relative mb-2 flex w-full flex-col",[n.user.id==h.value.id?"items-end":"items-start"]])},[e("div",{onContextmenu:Ue(V=>tt(V,n),["prevent"]),class:_(["relative block max-w-[90%] whitespace-pre-line break-all p-2 text-xs leading-normal tracking-wider shadow",[n.user.id==h.value.id&&r.editMessage&&k.value&&k.value.id!=n.id?"rounded-l-lg rounded-tr-lg bg-primary-blue text-white blur":n.user.id!=h.value.id&&r.editMessage?"rounded-r-lg rounded-bl-lg bg-white text-black blur":n.user.id==h.value.id?"rounded-l-lg rounded-tr-lg bg-primary-blue text-white":"rounded-r-lg rounded-bl-lg bg-white text-black"]])},[n.type=="image"?(s(),l("a",{key:0,href:n.attachement_path,download:n.attachement_name,class:"group relative mb-2 block min-h-[150px] min-w-[150px] overflow-hidden rounded"},[e("span",Pl,[e("span",ql,[p(i(Ee),{class:"h-5 w-5"})]),Zl]),e("img",{src:n.attachement_path,class:"max-h-[300px]",alt:""},null,8,Jl),e("span",Wl,[e("span",Gl,g(n.attachement_name),1),e("span",Ql,g(n.attachement_size),1)])],8,Yl)):c("",!0),n.type=="file"?(s(),l("a",{key:1,href:n.attachement_path,download:n.attachement_name,class:"group relative mb-2 flex w-[300px] items-stretch justify-start overflow-hidden rounded bg-white/25"},[e("span",ea,[e("span",ta,[p(i(Ee),{class:"h-5 w-5"})]),sa]),e("div",la,[e("span",null,g(n.attachement_name.split(".").pop()),1)]),e("div",aa,[e("span",oa,g(n.attachement_name),1),e("span",na,g(n.attachement_size),1)])],8,Xl)):c("",!0),e("span",ra,g(n.message),1),e("span",ia,[e("span",{class:_(["block h-2 w-2 rounded-full",[n.is_send?n.is_read?"bg-green-500":"bg-gray-300  ":"bg-red-500"]])},null,2),e("span",da,g(B(n.date,!1)),1),n.is_edit?(s(),l("span",ua,"Modifi\xE9")):c("",!0)])],42,Kl),k.value&&k.value.id==n.id&&r.editMessage?(s(),l("div",ca,[p(i(De),{onClick:o[6]||(o[6]=()=>{r.emoji=!r.emoji}),class:"absolute bottom-2 left-1 h-6 w-6 cursor-pointer text-gray-700"}),F(e("textarea",{ref_for:!0,ref_key:"textareaEdit",ref:fe,placeholder:"Your message...","onUpdate:modelValue":V=>k.value.message=V,onInput:o[7]||(o[7]=V=>je(V.target.value)),onKeydown:o[8]||(o[8]=Be(V=>et(V),["enter"])),rows:be.value,class:"w-full resize-none rounded-xl border border-gray-300 bg-white px-8 py-2 text-xs text-gray-900 shadow transition-all focus:border-primary-blue focus:ring-primary-blue",cols:"50"},null,40,ha),[[P,k.value.message]]),e("button",{type:"button",onClick:o[9]||(o[9]=V=>xe()),class:"absolute bottom-2 right-1 rounded-full bg-primary-blue p-1 text-white"},[i(z)==1?(s(),l("span",ga,[p(he,{size:"small"})])):(s(),l("span",pa,[p(i(Ae),{class:"h-4 w-4"})]))])])):c("",!0)],2))),128))]))),128)):c("",!0)])],512),F(e("div",fa,[e("div",ma,[e("input",{type:"file",id:"pickimage",class:"hidden",accept:"image/*",onChange:o[10]||(o[10]=t=>st(t)),disabled:r.editMessage},null,40,va),e("input",{type:"file",id:"pickfile",class:"hidden",onChange:o[11]||(o[11]=t=>lt(t)),disabled:r.editMessage},null,40,ba),e("label",{for:"pickimage",class:_(["mb-1 cursor-pointer rounded-full bg-white p-2 shadow",[r.editMessage?"blur":""]])},[e("span",null,[p(i(de),{class:"h-4 w-4 text-gray-500 md:h-5 md:w-5"})])],2),e("label",{for:"pickfile",class:_(["mb-1 cursor-pointer rounded-full bg-white p-2 shadow",[r.editMessage?"blur":""]])},[e("span",null,[p(i(ce),{class:"h-4 w-4 text-gray-500 md:h-5 md:w-5"})])],2),e("div",_a,[u.attachement?(s(),l("div",{key:0,class:_(["mb-0.5 flex w-full items-stretch overflow-hidden rounded bg-white/60",[r.editMessage?"blur":""]])},[e("div",ya,[u.type=="image"?(s(),l("img",{key:0,class:"h-full w-full object-cover",src:u.attachement_path,alt:""},null,8,xa)):(s(),l("div",wa,[e("span",null,g(u.attachement_name.split(".").pop()),1)]))]),e("div",ka,[e("h4",Ca,g(u.attachement_name),1),e("p",Ma,g(u.attachement_size),1)]),e("button",{type:"button",onClick:o[12]||(o[12]=t=>Y(!0)),class:"flex w-10 cursor-pointer items-center justify-center rounded bg-white"},[p(i(gt),{class:"h-5 w-5 text-primary-blue"})])],2)):c("",!0),F(e("div",{ref_key:"emojiBlock",ref:se,class:"emojiBlock absolute bottom-[110%] z-40 min-h-[100px] min-w-[100px] overflow-hidden rounded-xl bg-white shadow"},ja,512),[[E,r.emoji]]),p(i(De),{onClick:o[13]||(o[13]=()=>{r.editMessage||(r.emoji=!r.emoji)}),class:_(["absolute bottom-3 left-2 h-5 w-5 cursor-pointer text-gray-500",[r.editMessage?"blur":""]])},null,8,["class"]),F(e("textarea",{ref_key:"textarea",ref:pe,rows:ve.value,onKeydown:Be(Qe,["enter"]),"onUpdate:modelValue":o[14]||(o[14]=t=>u.message=t),onInput:Xe,disabled:r.editMessage,class:_(["mr-2 block w-full resize-none rounded-lg border border-gray-300 bg-white py-2.5 pl-8 pr-2.5 text-sm text-gray-900 shadow transition-all focus:border-primary-blue focus:ring-primary-blue",[r.editMessage?"blur":""]]),placeholder:"Your message..."},null,42,za),[[P,u.message]])]),e("button",{class:_([[r.editMessage?"blur":""],"mb-0.5 flex h-8 w-8 flex-shrink-0 cursor-pointer items-center justify-center rounded-full bg-primary-blue text-white shadow md:h-10 md:w-10"]),type:"button",onClick:o[15]||(o[15]=t=>$e()),disabled:r.editMessage},[i(z)==1?(s(),l("span",Fa,[p(he,{size:"small"})])):(s(),l("span",Sa,[p(i(Ae),{class:"h-5 w-5 md:h-6 md:w-6"})]))],10,Ha)])],512),[[E,d.value!=null]])],512),[[E,r.chat]])])]),F(e("div",Va,[e("div",Ba,[La,e("div",Ea,[k.value&&k.value.user.id==h.value.id?(s(),l("button",{key:0,onClick:o[16]||(o[16]=t=>we(!0)),type:"button",class:"rounded-full border border-gray-400 bg-white px-2 py-1 text-sm hover:bg-gray-100"}," Supprimer pour tout le monde ")):c("",!0),e("button",{onClick:o[17]||(o[17]=t=>we(!1)),type:"button",class:"rounded-full border border-gray-400 bg-white px-2 py-1 text-sm hover:bg-gray-100"}," Supprimer pour moi "),e("button",{onClick:o[18]||(o[18]=t=>r.deleteMessage=!1),type:"button",class:"rounded-full border border-gray-400 bg-white px-2 py-1 text-sm hover:bg-gray-100"}," Annuler ")])])],512),[[E,r.deleteMessage]])]))}};export{Za as default};
